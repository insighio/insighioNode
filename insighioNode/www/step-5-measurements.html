<!DOCTYPE html>

<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>insigh.io Device</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/spectre.min.css" />
  <link rel="stylesheet" href="css/spectre-icons.min.css" />
</head>

<body class="body-custom">
  <img src="img/logo.png" class="img-responsive px-2 py-2 img-center">

  <div class="panel panel-custom">
    <div class="columns">
      <div class="panel-nav col-12 hide-sm"><br />
        <ul class="step">
          <li class="step-item"><a>Login</a></li>
          <li class="step-item"><a>Select Network</a></li>
          <li class="step-item"><a>Network Params</a></li>
          <li class="step-item"><a>API Keys</a></li>
          <li class="step-item active"><a>Measurements</a></li>
          <li class="step-item"><a>Timing</a></li>
          <li class="step-item"><a>Verify</a></li>
        </ul>
        <br />
        <hr />
      </div>
    </div>

    <div class="panel-body">
      <br />
      <div id="loader" class="loading loading-lg"></div>
      <div class="container grid-lg">
        <div class="columns flex-centered">
          <div class="column col-xl-7 col-md-10 col-sm-12">
            <div class="form-group">
              <div class="columns">
                <div class="col-12">
                  <div class="divider text-center" data-content="Available measurements"></div>
                </div>
                <br />
                <div id="board-default-options" class="columns col-12" style="padding-right: 0px; padding-left: 0px">
                </div>
                <div id="board-default-option-gps" class="columns  col-12" style="padding-right: 0px; padding-left: 0px">
                </div>
                <br />
                <br />
                <div id="address-gps" class="columns flex-centered col-12">
                  <div class="column col-1 col-mr-auto"></div>
                  <div class="col-3 col-sm-12">
                    <label class="form-label" for="measurements">GPS Timeout (seconds)
                    </label>
                  </div>
                  <div class="col-3 col-sm-12">
                    <input class="form-input constr-field" type="number" id="input-gps-timeout" />
                  </div>
                  <div class="column col-5 col-mr-auto"></div>
                  <br />
                  <br />
                  <div class="column col-1 col-mr-auto"></div>
                  <div class="col-3 col-sm-12">
                    <label class="form-label" for="measurements">Min number of satellites
                    </label>
                  </div>
                  <div class="col-3 col-sm-12">
                    <input class="form-input constr-field" type="number" id="input-gps-sat-num" />
                  </div>
                  <div class="column col-5 col-mr-auto"></div>
                  <br />
                  <br />
                </div>
                <br />
                <br />
                <div class="col-12">
                  <div class="divider text-center" data-content="Device Selection"></div>
                </div>
                <br />
                <!-- board selector -->
                <div class="col-12">
                  <ul class="tab tab-block">
                    <li id="tab-shield-scale-options" class="tab-item" onclick="boardChanged(event, 'shield-scale-options')">
                      <a class="pointer">Cellular Digital/Scale</a>
                    </li>
                    <li id="tab-shield-dig-analog-options" class="tab-item active" onclick="boardChanged(event, 'shield-dig-analog-options')">
                      <a class="pointer">Cellular + Shield I²C/Analog</a>
                    </li>
                    <li id="tab-shield-advind-options" class="tab-item" onclick="boardChanged(event, 'shield-advind-options')">
                      <a class="pointer">Cellular + Shield SDI-12</a>
                    </li>
                  </ul>
                </div>
                <br />
                <br />
                <div id="shield-scale-options" class="tabcontent columns col-12" style="display: none; margin-left:5px; margin-right:5px">
                  <br />
                  <!-- <fieldset disabled> -->
                  <div class="form-group columns" id="shield-scale-options-content">
                    <br />
                    <br />
                  </div>
                  <!-- </fieldset> -->
                </div>
                <div id="shield-dig-analog-options" class="tabcontent columns col-12" style="display: block; margin-left:5px; margin-right:5px">
                  <br />
                  <div class="form-group columns">
                    <br />
                    <br />
                    <div class="col-4 col-lg-6 ">
                      <label class="form-label" for="measurements">I²C</label>
                    </div>
                    <div class="col-8 col-lg-6 ">
                      <select class="form-select" id="input-s1-i2c">
                      </select>
                    </div>
                    <br />
                    <br />
                    <div class="col-4 col-lg-6">
                      <label class="form-label" for="measurements">Analog / Digital P1</label>
                    </div>
                    <div class="col-8 col-lg-6">
                      <select class="form-select" id="input-s1-sensor-a-d-p1" onchange="selectionChanged(this)">
                      </select>
                    </div>
                    <br />
                    <div id="input-s1-sensor-a-d-p1-trans-div" class="col-12" style="display:block">
                      <br />
                      <div class="form-group columns">
                        <div class="column col-1 col-mr-auto"></div>
                        <div class="col-3  col-sm-12">
                          <label class="form-label" for="measurements">transformation
                            <button class="btn btn-link tooltip"
                              data-tooltip="python script to&#xa;transform raw Value (v)&#xa;from millivolt&#xa;to meaningful value&#xa;ex: 2*v + v**2">
                              <i class="icon icon-flag"></i>
                            </button>
                          </label>
                        </div>
                        <div class="col-6 col-sm-12">
                          <input class="form-input constr-field" id="input-s1-sensor-a-d-p1-t" />
                        </div>
                        <div class="column col-2 col-mr-auto"></div>
                      </div>
                    </div>
                    <br />
                    <div class="col-4 col-lg-6">
                      <label class="form-label" for="measurements">Analog / Digital P2</label>
                    </div>
                    <div class="col-8 col-lg-6">
                      <select class="form-select" id="input-s1-sensor-a-d-p2" onchange="selectionChanged(this)">
                      </select>
                    </div>
                    <div id="input-s1-sensor-a-d-p2-trans-div" class="col-12" style="display:none">
                      <br />
                      <div class="form-group columns">
                        <div class="column col-1 col-mr-auto"></div>
                        <div class="col-3  col-sm-12">
                          <label class="form-label" for="measurements">transformation
                            <button class="btn btn-link tooltip"
                              data-tooltip="python script to&#xa;transform raw value (v)&#xa;from millivolt&#xa;to meaningful value&#xa;ex: 2*v + v**2">
                              <i class="icon icon-flag"></i>
                            </button>
                          </label>
                        </div>
                        <div class="col-6 col-sm-12">
                          <input class="form-input constr-field" id="input-s1-sensor-a-d-p2-t" />
                        </div>
                        <div class="column col-2 col-mr-auto"></div>
                      </div>
                    </div>
                    <br />
                    <br />
                    <div class="col-4 col-lg-6">
                      <label class="form-label" for="measurements">Analog / Digital P3</label>
                    </div>
                    <div class="col-8 col-lg-6">
                      <select class="form-select" id="input-s1-sensor-a-d-p3" onchange="selectionChanged(this)">
                      </select>
                    </div>
                    <div id="input-s1-sensor-a-d-p3-trans-div" class="col-12" style="display:none">
                      <br />
                      <div class="form-group columns">
                        <div class="column col-1 col-mr-auto"></div>
                        <div class="col-3  col-sm-12">
                          <label class="form-label" for="measurements">transformation
                            <button class="btn btn-link tooltip"
                              data-tooltip="python script to&#xa;transform raw value (v)&#xa;from millivolt&#xa;to meaningful value&#xa;ex: 2*v + v**2">
                              <i class="icon icon-flag"></i>
                            </button>
                          </label>
                        </div>
                        <div class="col-6 col-sm-12">
                          <input class="form-input constr-field" id="input-s1-sensor-a-d-p3-t" />
                        </div>
                        <div class="column col-2 col-mr-auto"></div>
                      </div>
                    </div>
                    <br />
                    <br />
                  </div>
                </div>
                <!-- sdi board related settings -->
                <div id="shield-advind-options" class="tabcontent columns col-12" style="display: none; margin-left:5px; margin-right:5px">
                  <br />
                  <div class="form-group columns">
                    <br />
                    <br />
                    <table class="table table-striped table-hover">
                      <thead>
                        <tr>
                          <th>Index</th>
                          <th>Sensor ID</th>
                          <th>Board Location</th>
                          <th>Active</th>
                        </tr>
                      </thead>
                      <tbody id="option-sdi12-table-rows">
                      </tbody>
                    </table>
                    <div class="form-group columns" id="options-sdi12">
                    </div>
                  </div>
                </div>
                <div class="form-group col-12">
                  <div class="divider text-center" data-content="Explicit key-values"></div>
                </div>
                <br />
                <div id="keyvalue" class="form-group col-12">
                  <br />
                  <table class="table">
                    <thead>
                      <tr>
                        <th>key</th>
                        <th>value</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="active">
                        <td><input type="text" id="input-key-name-0" placeholder="key name" style="width: 100%"></td>
                        <td><input type="text" id="input-key-value-0" placeholder="key value" style="width: 100%"></td>
                      </tr>
                      <tr>
                        <td><input type="text" id="input-key-name-1" placeholder="key name" style="width: 100%"></td>
                        <td><input type="text" id="input-key-value-1" placeholder="key value" style="width: 100%"></td>
                      </tr>
                      <tr class="active">
                        <td><input type="text" id="input-key-name-2" placeholder="key name" style="width: 100%"></td>
                        <td><input type="text" id="input-key-value-2" placeholder="key value" style="width: 100%"></td>
                      </tr>
                      <tr>
                        <td><input type="text" id="input-key-name-3" placeholder="key name" style="width: 100%"></td>
                        <td><input type="text" id="input-key-value-3" placeholder="key value" style="width: 100%"></td>
                      </tr>
                      <tr class="active">
                        <td><input type="text" id="input-key-name-4" placeholder="key name" style="width: 100%"></td>
                        <td><input type="text" id="input-key-value-4" placeholder="key value" style="width: 100%"></td>
                      </tr>
                    </tbody>
                  </table>
                  <br />
                </div>
              </div>
              <div class="column col-12">
                <button class="btn btn-primary float-right" onClick="validateMyForm()" id="save-button" style="margin-left: 30px">Save</button>
                <button class="btn btn-primary float-right" type="button" id="back-button" onclick="goBack()">Back</button>
              </div>
              <br />
              <br />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script src="js/js.cookie.min.js"></script>
  <script src="js/utils.js"></script>
  <script>
    var shieldNamePerTab = {
      "shield-advind-options": "advind",
      "shield-scale-options": "scale",
      "shield-dig-analog-options": "dig_analog"
    }

    var tabNamePerShield = {
      "ins_esp_gen_sdi12": "shield-advind-options",
      "ins_esp_gen_1": "shield-scale-options",
      "ins_gen_s3": "shield-dig-analog-options",
      "advind": "shield-advind-options",
      "scale": "shield-scale-options",
      "dig_analog": "shield-dig-analog-options",
    }

    const i2cOptions = {
      "disabled": "disabled",
      "tsl2561": "tsl2561 - luminosity",
      "sht20": "sht20 - temperature / humidity",
      "sht40": "sht40 - temperature / humidity",
      "si7021": "si7021 - temperature / humidity",
      "scd30": "scd30 - C02 / temperature / humidity",
      "bme680": "bme680 - gap / temperature / humidity",
      "sunrise": "sunrise - CO2 / temperature",
      "scd4x": "scd4x - CO2 / temperature / humidity",
      "sgx7ox": "sgx7ox - industrial oxygen sensor ",
    }

    const adcOptions = {
      "disabled": "disabled",
      "dht11": "dht11 - temperature / humidity (digital)",
      "dht22": "dht22 - temperature / humidity (digital)",
      "ds18x20": "ds18x20 - temperature (OneWire)",
      "analog": "generic analog"
    }

    const pcnt_trigger = {
      "rising": "Count on Rising",
      "falling": "Count on Falling"
    }

    const temperature_unit = {
      "true": "Celsius (°C)",
      "false": "Fahrenheit (°F)"
    }

    let sdi12Options = {
    }

    let sdi12LocationOptions = {
      "1": "SDI snr 1",
      "2": "SDI snr 2"
    }

    let settings = undefined

    function initializeValues() {
      disableNavigationButtons()

      addSwitch("board-default-options", "input-led-enabled", "LED notifications")
      addSwitch("board-default-options", "input-battery", "Battery statistics")
      addSwitch("board-default-options", "input-board-sense", "Board humidity/temperature")
      addSwitch("board-default-options", "input-board-stat", "Board health statistics")
      addSwitch("board-default-options", "input-network", "Network statistics")
      addSwitch("board-default-options", "input-ota", "Over the Air Updates")
      addSwitch("board-default-options", "input-store-meas-if-failed-conn", "Store measurement if no connection")

      addSelect("board-default-options", "input-temp-unit", "Temperature Unit")

      addSwitch("board-default-option-gps", "input-gps-enable", "GPS")
      addSwitch("address-gps", "input-gps-no-fix-no-upload", "Discard measurements if no GPS fix")

      addSelect("shield-scale-options-content", "input-i2c-1", "I²C #1")
      addSelect("shield-scale-options-content", "input-i2c-2", "I²C #2")
      addSelect("shield-scale-options-content", "input-sensor-a-d-p1", "Analog / Digital P1")
      addSwitch("shield-scale-options-content", "input-scale-enabled", "Weight Scale")
      addSwitch("shield-scale-options-content", "input-scale-monitoring", "[Debug] Enable Scale Sensor Monitoring")

      addInput('options-sdi12', 'input-gen-sdi12-warmup-time', 'Warm Up time (ms)')
      addSwitch("options-sdi12", "ins-esp-gen-4-20-snsr-1-enable", "4-20mA sensor n.1")
      addSwitch("options-sdi12", "ins-esp-gen-4-20-snsr-2-enable", "4-20mA sensor n.2")
      addSwitch("options-sdi12", "ins-esp-gen-pcnt-1-enable", "Pulse Counter Enable")
      addSelect("options-sdi12", "ins-esp-gen-pcnt-1-cnt-on", "Pulse Counter Trigger")
      addInput('options-sdi12', 'ins-esp-gen-pcnt-1-multiplier', 'Pulse Counter Multiplier')
      //addIn

      generateOptions("input-i2c-1", i2cOptions)
      generateOptions("input-i2c-2", i2cOptions)
      generateOptions("input-s1-i2c", i2cOptions)

      generateOptions("input-sensor-a-d-p1", adcOptions)
      generateOptions("input-s1-sensor-a-d-p1", adcOptions)
      generateOptions("input-s1-sensor-a-d-p2", adcOptions)
      generateOptions("input-s1-sensor-a-d-p3", adcOptions)

      generateOptions("ins-esp-gen-pcnt-1-cnt-on", pcnt_trigger)
      generateOptions("input-temp-unit", temperature_unit)

      generateSdi12Options()

      var gps = strToJSValue(Cookies.get("meas-gps-enabled"))

      setElemValueBool('input-led-enabled', strToJSValue(Cookies.get("meas-led-enabled")), true)
      setElemValueBool('input-battery', strToJSValue(Cookies.get("meas-battery-stat")), true)
      setElemValueBool('input-board-sense', strToJSValue(Cookies.get("meas-board-sense")), true)
      setElemValueBool('input-board-stat', strToJSValue(Cookies.get("meas-board-stat")), false)
      setElemValueBool('input-network', strToJSValue(Cookies.get("meas-network-stat")), true)
      setElemValueBool('input-ota', strToJSValue(Cookies.get("system-enable-ota")), true)
      setElemValueBool('input-scale-enabled', strToJSValue(Cookies.get("meas-scale-enabled")), false)
      setElemValueBool('input-scale-monitoring', strToJSValue(Cookies.get("meas-scale-monitoring-enabled")), false)

      setElemValueBool('input-gps-enable', gps, true)
      setElemValueBool('input-temp-unit', strToJSValue(Cookies.get("meas-temp-unit")), true, "value")

      var selectedShield = Cookies.get("selected-shield") ? Cookies.get("selected-shield") : Cookies.get("selected-board")

      console.log("selected shield/board: ", Cookies.get("selected-shield"), Cookies.get("selected-board"), tabNamePerShield[selectedShield])
      if (selectedShield && tabNamePerShield[selectedShield])
        boardChanged(undefined, tabNamePerShield[selectedShield])

      setElemValue('input-gps-timeout', Cookies.get("meas-gps-timeout"), 120, false)
      setElemValue('input-gps-sat-num', Cookies.get("meas-gps-sat-num"), 4, false)
      //setElemValueBool('input-gps-no-fix-no-upload', Cookies.get(meas-gps-no-fix-no-upload,  false)

      for (let i = 1; i <= 10; ++i) {
        var sdi12Enabled = strToJSValue(Cookies.get("meas-sdi-" + i + "-enabled"))

        setElemValue('option-ins-esp-gen-sdi12-' + i + '-address', Cookies.get("meas-sdi-" + i + "-address"), i - 1)
        setElemValueBool('option-ins-esp-gen-sdi12-' + i + '-enabled', sdi12Enabled, false)
        setElemValue('option-ins-esp-gen-sdi12-' + i + '-loc', Cookies.get("meas-sdi-" + i + "-loc"), 1)
      }

      setElemValue('input-gen-sdi12-warmup-time', Cookies.get("meas-sdi-warmup-time"), 1000)

      var adp1 = fromMultiWordToOne(Cookies.get("meas-sensor-a-d-p1"))
      var adp2 = fromMultiWordToOne(Cookies.get("meas-sensor-a-d-p2"))
      var adp3 = fromMultiWordToOne(Cookies.get("meas-sensor-a-d-p3"))

      setElemValue('input-i2c-1', Cookies.get("meas-i2c-1"), "disabled")
      setElemValue('input-s1-i2c', Cookies.get("meas-i2c-1"), "disabled")
      setElemValue('input-i2c-2', Cookies.get("meas-i2c-2"), "disabled")
      setElemValue('input-sensor-a-d-p1', adp1, "disabled")
      setElemValue('input-s1-sensor-a-d-p1', adp1, "disabled")
      setElemValue('input-s1-sensor-a-d-p2', adp2, "disabled")
      setElemValue('input-s1-sensor-a-d-p3', adp3, "disabled")

      setElemValue("input-s1-sensor-a-d-p1-t", Cookies.get("meas-sensor-a-d-p1-t"), "v")
      setElemValue("input-s1-sensor-a-d-p2-t", Cookies.get("meas-sensor-a-d-p2-t"), "v")
      setElemValue("input-s1-sensor-a-d-p3-t", Cookies.get("meas-sensor-a-d-p3-t"), "v")

      showElement('input-s1-sensor-a-d-p1-trans-div', adp1 === "analog")
      showElement('input-s1-sensor-a-d-p2-trans-div', adp2 === "analog")
      showElement('input-s1-sensor-a-d-p3-trans-div', adp3 === "analog")


      setElemValueBool('ins-esp-gen-4-20-snsr-1-enable', strToJSValue(Cookies.get("meas-4-20-snsr-1-enable")), false)
      setElemValueBool('ins-esp-gen-4-20-snsr-2-enable', strToJSValue(Cookies.get("meas-4-20-snsr-2-enable")), false)
      setElemValueBool('ins-esp-gen-pcnt-1-enable', strToJSValue(Cookies.get("meas-pcnt-1-enable")), false)
      setElemValue('ins-esp-gen-pcnt-1-cnt-on', strToJSValue(Cookies.get("meas-pcnt-1-cnt-on-rising")) ? "rising" : "falling", "rising")
      setElemValue('ins-esp-gen-pcnt-1-multiplier', Cookies.get("meas-pcnt-1-multiplier"), 1)

      setElemValueBool('input-store-meas-if-failed-conn', strToJSValue(Cookies.get("store-meas-if-failed-conn")), false)

      fillKeyValuePairsFromDictionary(Cookies.get("meas-keyvalue"))

      detectBoardChange(enableNavigationButtons)
    }

    function clearCookies() {
      Cookies.remove('meas-led-enabled')
      Cookies.remove('meas-battery-stat')
      Cookies.remove('meas-board-sense')
      Cookies.remove('meas-board-stat')
      Cookies.remove('meas-gps-enabled')
      Cookies.remove('meas-gps-no-fix-no-upload')
      Cookies.remove('meas-gps-sat-num')
      Cookies.remove('meas-gps-timeout')
      Cookies.remove('meas-i2c-1')
      Cookies.remove('meas-i2c-2')
      Cookies.remove('meas-network-stat')
      Cookies.remove('meas-scale-enabled')
      Cookies.remove('meas-scale-offset')
      Cookies.remove('meas-scale-scale')
      Cookies.remove('meas-sensor-a-d-p1')
      Cookies.remove('meas-sensor-a-d-p1-t')
      Cookies.remove('meas-sensor-a-d-p2')
      Cookies.remove('meas-sensor-a-d-p2-t')
      Cookies.remove('meas-sensor-a-d-p3')
      Cookies.remove('meas-sensor-a-d-p3-t')
      Cookies.remove('meas-sensor-scale-enabled')
      Cookies.remove('meas-temp-unit')
      Cookies.remove('selected-shield')
      Cookies.remove('system-enable-ota')
      Cookies.remove('meas-keyvalue')
      Cookies.remove('store-meas-if-failed-conn')
      Cookies.remove('meas-4-20-snsr-1-enable')
      Cookies.remove('meas-4-20-snsr-2-enable')
      Cookies.remove('meas-scale-monitoring-enabled')
      Cookies.remove('meas-pcnt-1-enable')
      Cookies.remove('meas-pcnt-1-cnt-on-rising')
      Cookies.remove('meas-pcnt-1-multiplier')

      for (let i = 1; i < 11; ++i) {
        Cookies.remove('meas-sdi-' + i + '-enabled')
        Cookies.remove('meas-sdi-' + i + '-address')
        Cookies.remove('meas-sdi-' + i + '-loc')
      }
    }

    function setSDI12Cookie(i) {
      var elem_address = document.getElementById('option-ins-esp-gen-sdi12-' + i + '-address')
      var elem_location = document.getElementById('option-ins-esp-gen-sdi12-' + i + '-loc')
      var elem_enabled = boolElemToPyStr('option-ins-esp-gen-sdi12-' + i + '-enabled')

      Cookies.set('meas-sdi-' + i + '-enabled', elem_enabled !== undefined ? elem_enabled : "False")
      Cookies.set('meas-sdi-' + i + '-address', elem_address ? elem_address.value : "0")
      Cookies.set('meas-sdi-' + i + '-loc', elem_location ? elem_location.value : "1")
    }

    function storeData() {
      disableNavigationButtons()
      clearCookies();

      Cookies.set('meas-led-enabled', boolElemToPyStr('input-led-enabled'))
      Cookies.set('meas-battery-stat', boolElemToPyStr('input-battery'))
      Cookies.set('meas-board-sense', boolElemToPyStr('input-board-sense'))
      Cookies.set('meas-board-stat', boolElemToPyStr('input-board-stat'))
      Cookies.set('meas-network-stat', boolElemToPyStr('input-network'))
      Cookies.set('system-enable-ota', boolElemToPyStr('input-ota'))
      Cookies.set('meas-gps-enabled', boolElemToPyStr('input-gps-enable'))

      Cookies.set('meas-temp-unit', boolElemToPyStr('input-temp-unit', 'value'))

      Cookies.set('meas-gps-timeout', document.getElementById('input-gps-timeout').value)
      Cookies.set('meas-gps-sat-num', document.getElementById('input-gps-sat-num').value)
      Cookies.set('meas-gps-no-fix-no-upload', boolElemToPyStr('input-gps-no-fix-no-upload'))

      Cookies.set('store-meas-if-failed-conn', boolElemToPyStr('input-store-meas-if-failed-conn'))

      if (elementIsVisible("shield-advind-options")) {
        Cookies.set('selected-shield', shieldNamePerTab["shield-advind-options"])

        for (let i = 1; i < 11; ++i) {
          setSDI12Cookie(i)
        }

        Cookies.set('meas-4-20-snsr-1-enable', boolElemToPyStr('ins-esp-gen-4-20-snsr-1-enable'))
        Cookies.set('meas-4-20-snsr-2-enable', boolElemToPyStr('ins-esp-gen-4-20-snsr-2-enable'))

        Cookies.set('meas-sdi-warmup-time', document.getElementById('input-gen-sdi12-warmup-time').value)

        Cookies.set('meas-sdi-warmup-time', document.getElementById('input-gen-sdi12-warmup-time').value)

        Cookies.set('meas-pcnt-1-enable', boolElemToPyStr('ins-esp-gen-pcnt-1-enable'))
        Cookies.set('meas-pcnt-1-cnt-on-rising', document.getElementById('ins-esp-gen-pcnt-1-cnt-on').value === "rising")
        Cookies.set('meas-pcnt-1-multiplier', document.getElementById('ins-esp-gen-pcnt-1-multiplier').value)

        Cookies.set('meas-keyvalue', JSON.stringify(getKeyValuePairs()))
        redirectTo("step-5-4-measurement-naming.html")
      }
      else if (elementIsVisible("shield-scale-options")) {
        Cookies.set('selected-shield', shieldNamePerTab["shield-scale-options"])
        Cookies.set('meas-i2c-1', document.getElementById('input-i2c-1').value)
        Cookies.set('meas-i2c-2', document.getElementById('input-i2c-2').value)
        Cookies.set('meas-sensor-a-d-p1', document.getElementById('input-sensor-a-d-p1').value)
        Cookies.set('meas-scale-enabled', boolElemToPyStr('input-scale-enabled'))
        Cookies.set('meas-scale-monitoring-enabled', boolElemToPyStr('input-scale-monitoring'))

        if (!isChecked('input-scale-enabled')) {
          Cookies.set('meas-scale-offset', 0)
          Cookies.set('meas-scale-scale', 1)
          redirectTo("step-5-4-measurement-naming.html")
        }
        else {
          var scale = Cookies.get("meas-scale-scale")
          var offset = Cookies.get("meas-scale-offset")

          console.log("offset: ", offset, ", scale:", scale)

          if (scale && offset) {
            Cookies.set('meas-scale-offset', offset)
            Cookies.set('meas-scale-scale', scale)
            Cookies.set('meas-keyvalue', JSON.stringify(getKeyValuePairs()))
            redirectTo("step-5-3-scale-calibr-res.html")
          }
          else {
            Cookies.set('meas-keyvalue', JSON.stringify(getKeyValuePairs()))
            redirectTo("step-5-1-scale-idle.html")
          }
        }
      }
      else if (elementIsVisible("shield-dig-analog-options")) {
        Cookies.set('selected-shield', shieldNamePerTab["shield-dig-analog-options"])
        Cookies.set('meas-i2c-1', document.getElementById('input-s1-i2c').value)
        Cookies.set('meas-sensor-a-d-p1', document.getElementById('input-s1-sensor-a-d-p1').value)
        Cookies.set('meas-sensor-a-d-p2', document.getElementById('input-s1-sensor-a-d-p2').value)
        Cookies.set('meas-sensor-a-d-p3', document.getElementById('input-s1-sensor-a-d-p3').value)

        if (elementIsVisible('input-s1-sensor-a-d-p1-trans-div'))
          Cookies.set('meas-sensor-a-d-p1-t', document.getElementById('input-s1-sensor-a-d-p1-t').value)

        if (elementIsVisible('input-s1-sensor-a-d-p2-trans-div'))
          Cookies.set('meas-sensor-a-d-p2-t', document.getElementById('input-s1-sensor-a-d-p2-t').value)

        if (elementIsVisible('input-s1-sensor-a-d-p3-trans-div'))
          Cookies.set('meas-sensor-a-d-p3-t', document.getElementById('input-s1-sensor-a-d-p3-t').value)

        Cookies.set('meas-keyvalue', JSON.stringify(getKeyValuePairs()))
        redirectTo("step-5-4-measurement-naming.html")
      }

      enableNavigationButtons()
    }

    function boardChanged(evt, boardDivId) {
      console.log("boardChanged: ", boardDivId)
      var i, tabcontent, tablinks;

      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }

      tablinks = document.getElementsByClassName("tab-item");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }

      showElement(boardDivId, true)
      document.getElementById("tab-" + boardDivId).className += " active";
    }

    function validateMyForm() {
      storeData()
      return true
    }

    function selectionChanged(selectObj) {
      showElement(selectObj.id + "-trans-div", selectObj.value === "analog")
    }

    function generateSdi12Options() {
      var parent = document.getElementById("option-sdi12-table-rows");

      for (let i = 0; i < 10; i++) {
        sdi12Options[i.toString()] = i
      }

      for (let i = 1; i <= 10; i++) {
        var row = document.createElement("tr")
        if (i % 1)
          row.classList.add('active')

        var col1 = document.createElement("td")
        col1.appendChild(document.createTextNode("SDI-12 n." + i));
        row.appendChild(col1)

        var col2 = document.createElement("td")
        var selectElem_address = document.createElement("select")
        selectElem_address.classList.add('form-select')
        selectElem_address.id = 'option-ins-esp-gen-sdi12-' + i + '-address'
        col2.appendChild(selectElem_address)
        row.appendChild(col2)

        var col3 = document.createElement("td")
        var selectElem_location = document.createElement("select")
        selectElem_location.classList.add('form-select')
        selectElem_location.id = 'option-ins-esp-gen-sdi12-' + i + '-loc'
        col3.appendChild(selectElem_location)
        row.appendChild(col3)

        var col4 = document.createElement("td")
        var switchLabel = document.createElement("label")
        switchLabel.classList.add('form-switch')

        var switchInput = document.createElement("input")
        switchInput.type = "checkbox"
        switchInput.id = 'option-ins-esp-gen-sdi12-' + i + '-enabled'

        var switchIcon = document.createElement("i")
        switchIcon.classList.add('form-icon')

        switchLabel.appendChild(switchInput)
        switchLabel.appendChild(switchIcon)
        col4.appendChild(switchLabel)
        row.appendChild(col4)

        parent.appendChild(row)

        generateOptions(selectElem_address.id, sdi12Options)
        generateOptions(selectElem_location.id, sdi12LocationOptions)
        setElemValue(selectElem_address.id, i - 1, 0)
      }
    }

    initializeValues()
  </script>
</body>

</html>
